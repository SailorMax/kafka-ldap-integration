buildscript {
    ext.kotlin_version = '1.2.21'

    repositories {
        mavenCentral()
    }
    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
        classpath "org.junit.platform:junit-platform-gradle-plugin:1.0.1"
        classpath 'com.github.jengelman.gradle.plugins:shadow:2.0.2'
    }
}

plugins{
    id "org.jetbrains.kotlin.jvm" version "1.2.21"
    id 'org.junit.platform.gradle.plugin' version '1.0.1'
    id 'com.github.johnrengelman.shadow' version '2.0.2'
}

apply plugin: 'maven-publish'

group 'org.navit.common.security'
version '1.0-SNAPSHOT'

sourceCompatibility = 1.8

repositories {
    jcenter()
    mavenCentral()
}

dependencies {
    compile "org.jetbrains.kotlin:kotlin-stdlib-jdk8"
    compile "com.unboundid:unboundid-ldapsdk:4.0.3"
    compile 'org.yaml:snakeyaml:1.19'
    compile 'org.apache.kafka:kafka_2.12:1.0.0'

    testImplementation "org.amshove.kluent:kluent:1.33"
    testCompile "org.jetbrains.spek:spek-api:1.1.5"
    testRuntime "org.jetbrains.spek:spek-junit-platform-engine:1.1.5"
    testRuntime "org.slf4j:slf4j-jdk14:1.7.25"
}

compileKotlin {
    kotlinOptions.jvmTarget = "1.8"
}
compileTestKotlin {
    kotlinOptions.jvmTarget = "1.8"
}

shadowJar {
    dependencies {
        exclude(dependency('org.apache.kafka::'))
        exclude(dependency('org.lz4::'))
        exclude(dependency('org.xerial.snappy::'))
        exclude(dependency('org.slf4j::'))
        exclude(dependency('com.yammer.metrics::'))
        exclude(dependency('com.101tec::'))
        exclude(dependency('org.apache.zookeeper::'))
        exclude(dependency('log4j::'))
        exclude(dependency('com.fasterxml.jackson.core::'))
        exclude(dependency('net.sf.jopt-simple::'))
        exclude(dependency('org.scala-lang::'))
    }
}

publishing {
    publications {
        shadow(MavenPublication) { publication ->
            project.shadow.component(publication)
        }
    }
    repositories {
        maven {
            credentials {
                username "d"
                password "d"
            }
            url "https://repo.adeo.no/repository/maven-snapshots/"
        }
    }
}

task copyJarToKafka(type: Copy) {
    from 'build/libs/KafkaPlainSaslServer2AD-1.0-SNAPSHOT-all.jar'
    into "/Users/torsteinnesby/confluent-4.0.0-SA/share/java/kafka/"
}